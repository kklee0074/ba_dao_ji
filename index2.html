<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<title>Credit Login / Register Form a Responsive Widget Template :: w3layouts</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Credit Login / Register Form Responsive Widget,Login form widgets, Sign up Web forms , Login signup Responsive web form,Flat Pricing table,Flat Drop downs,Registration Forms,News letter Forms,Elements" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- Custom Theme files -->
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all">
<link href="css/popuo-box.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- //Custom Theme files -->
<!-- web font -->
<!--<link href="//fonts.googleapis.com/css?family=Oswald:400,700" rel="stylesheet">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">-->
<style>
body::after {
  content: "";
  background: url(http://www.itbriefcase.net/wp-content/uploads/2018/04/cloud-security.jpg)no-repeat 0;
  background-size: cover;
  opacity: 0.5;
  top: 0;
  left: 0;
  bottom: -200px;
  right: 0;
  position: absolute;
  z-index: -1;   
}

h1 {
    color: black;
    background: aliceblue;
    display: block;
    width: 560px;
    border-radius: 10px;
    margin: 35px auto;
	text-transform: none;
}

#btn_reg_store {
	background: #fff;
    color: #000;
    outline: none;
    display: block;
    margin: 0 auto;
    border: none;
    cursor: pointer;
    padding: 9px 38px;
    font-size: 14px;
    margin-top: 55px;
    font-weight: bold;
    text-transform: uppercase;
    font-family: 'Open Sans', sans-serif;
    transition: 0.3s all;
    -webkit-transition: 0.3s all;
}
#btn_reg_store:hover{
    background: #df5799;
	color:#ffffff;
	transition: 0.3s all;
    -webkit-transition: 0.3s all;
    -moz-transition: 0.3s all;
    -o-transition: 0.3s all;
    -ms-transition: 0.3s all;
}
</style>
<!-- //web font -->
</head>
<body>
<h1>NAS Personal Data Protection System</h1>
<div class="main-agileits">
<!--form-stars-here-->
		<div class="form-w3-agile">
			<h2>NAS PDPS login</h2>
			<form action="#" method="post">
				<div class="form-sub-w3">
					<input type="text" name="Username" placeholder="Email address " required="" />
				<div class="icon-w3">
					<i class="fa fa-user" aria-hidden="true"></i>
				</div>
				</div>
				<div class="form-sub-w3">
					<input type="password" name="Password" placeholder="Password" required="" />
				<div class="icon-w3">
					<i class="fa fa-unlock-alt" aria-hidden="true"></i>
				</div>
				</div>
				<p class="p-bottom-w3ls">Are you new to NAS PDPS?<a class="w3_play_icon1" href="#small-dialog1">  Register here</a></p>
				
				<div class="submit-w3l">
					<input type="submit" value="Login">
				</div>
			</form>
		</div>
<!--//form-ends-here-->
</div>
<div id="small-dialog1" class="mfp-hide">
					<div class="contact-form1">
										<div class="contact-w3-agileits">
										<h3>NAS PDPS Registration</h3>
											<form action="#" method="post">
												<div class="form-sub-w3ls">
													<input id="txt_email" placeholder="Email" class="mail" type="email" required="">
													<div class="icon-agile">
														<i class="fa fa-envelope-o" aria-hidden="true"></i>
													</div>
												</div>
												<div class="form-sub-w3ls">
													<input id="txt_password" placeholder="Password"  type="password" required="">
													<div class="icon-agile">
														<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</div>
												</div>
												<div class="form-sub-w3ls">
													<input id="txt_confirm_password" placeholder="Confirm Password"  type="password" required="">
													<div class="icon-agile">
														<i class="fa fa-unlock-alt" aria-hidden="true"></i>
													</div>
												</div>
												<h2 style="color: white; margin-bottom: 20px;">Optional field for data storage</h2>
												<div class="form-sub-w3ls">
													<label style="float: left; padding-left: 10px;">Full Name</label>
													<input id="txt_name" placeholder="Your full name"  type="text">
												</div>														
												<div class="form-sub-w3ls">
													<label style="float: left; padding-left: 10px;">Mobile Phone No</label>
													<input id="txt_mobile" placeholder="Your mobile phone no"  type="text">
												</div>												
												<div class="form-sub-w3ls">
													<label style="float: left; padding-left: 10px;">National Identity Number</label>
													<input id="txt_nric" placeholder="Your Identity Card No."  type="text">
												</div>							
												<div class="form-sub-w3ls">
													<label style="float: left; padding-left: 10px;">Address</label>
													<input id="txt_address" placeholder="Your full address"  type="text">
												</div>	
											</div>
											<!--<div class="login-check">
								 			 <label class="checkbox"><input type="checkbox" name="checkbox" checked=""><p>I Accept Terms & Conditions</p></label>
											</div>-->
										<div class="submit-w3l">
											<button id="btn_reg_store">Register & Store</button>
										</div>
										</form>
					</div>	
				</div>
<!-- copyright -->
	<div class="copyright w3-agile">
		<p> © 2017 Credit Login / Register Form . All rights reserved | Design by <a href="http://w3layouts.com/" target="_blank">W3layouts</a></p>
	</div>
	<!-- //copyright --> 
	<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
	<!--<script src=lib/bootstrap-4.0.0-dist/js/bootstrap.min.js></script>-->
	<!-- Nebulas SDK related script -->
	<script src="lib/nebPay.js"></script>	
	<script src="lib/nebulas.js"></script>	
	<!-- //Nebulas SDK related script -->
	<!-- pop-up-box -->  
	<script src="js/jquery.magnific-popup.js" type="text/javascript"></script>
	<!--//pop-up-box -->
	<script>
		"use strict";
		
		var dappAddress = "n1jDzqzQRDfoSUNAqwNXgSvrWAJptzEh3dX";
		//here we use neb.js to call the "get" function to search from the Dictionary
		var nebulas = require("nebulas"),
			Account = nebulas.Account,
			neb = new nebulas.Neb();
		neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));		
	
		document.addEventListener("DOMContentLoaded", function () {
		    console.log("web page loaded...")
		    setTimeout(checkNebpay, 1000);
		});
		function checkNebpay() {
		    console.log("check nebpay")
		    try {
			var NebPay = require("nebpay");
			console.log(`nebPay installed great`);
		    } catch (e) {
			console.log(e);
			if (window.confirm('You dont have the Chrome web wallet extension installed to use this Dapp click Confirm to download now ')) {
			    window.location.href = 'https://github.com/ChengOrangeJu/WebExtensionWallet';
			}
		    }
		}	
		
		var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
		var nebPay = new NebPay();
		var serialNumber;
		//var callbackUrl = NebPay.config.mainnetUrl;   //如果合约在主网,则使用这个
		//var callbackUrl = NebPay.config.testnetUrl;   //
		var callbackUrl = "https://testnet.nebulas.io";
		$("#btn_reg_store").click(function() {
			var to = dappAddress;
			var value = "0";
			var callFunction = "save"
			//var callArgs = "[\"" + $("#search_value").val() + "\",\"" + $("#add_value").val() + "\"]"
			var arg1 = $("#txt_email").val(),
				arg2 = $("#txt_password").val(),
				arg3 = $("#txt_name").val(),
				arg4 = $("#txt_mobile").val(),
				arg5 = $("#txt_nric").val(),
				arg6 = $("#txt_address").val();
			var callArgs = JSON.stringify([arg1, arg2, arg3, arg4, arg5, arg6]);
			serialNumber = nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
				listener: cbPush,       //设置listener, 处理交易返回信息
				callback: callbackUrl
			});
			alert(serialNumber);
			intervalQuery = setInterval(function () {
				funcIntervalQuery();
			}, 10000);
		});
		var intervalQuery;
		function funcIntervalQuery() {
			var options = {
				callback: callbackUrl
			}
			nebPay.queryPayInfo(serialNumber,options)   //search transaction result from server (result upload to server by app)
				.then(function (resp) {
					console.log("tx result: " + resp)   //resp is a JSON string
					var respObject = JSON.parse(resp)
					if(respObject.code === 0){
						clearInterval(intervalQuery);
						alert(`set ${$("#txt_email").val()} succeed!`);
					}
				})
				.catch(function (err) {
					console.log(err);
				});
		}
		function cbPush(resp) {
			console.log("response of push: " + JSON.stringify(resp))
			var respString = JSON.stringify(resp);
			if(respString.search("rejected by user") !== -1){
				clearInterval(intervalQuery)
				alert(respString)
			}else if(respString.search("txhash") !== -1){
				//alert("wait for tx result: " + resp.txhash)
			}
		}	
	
		$(document).ready(function() {
		$('.w3_play_icon,.w3_play_icon1,.w3_play_icon2').magnificPopup({
			type: 'inline',
			fixedContentPos: false,
			fixedBgPos: true,
			overflowY: 'auto',
			closeBtnInside: true,
			preloader: false,
			midClick: true,
			removalDelay: 300,
			mainClass: 'my-mfp-zoom-in'
		});
																		
		});
	</script>
</body>
</html>
